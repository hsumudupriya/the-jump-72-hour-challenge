services:
    - type: web
      name: ai-email-sorter
      runtime: node
      region: oregon
      plan: starter
      buildCommand: npm ci && npx prisma generate && npx prisma db push && npm run build && npx playwright install chromium --with-deps
      startCommand: npm start
      healthCheckPath: /
      envVars:
          - key: NODE_ENV
            value: production
          - key: DATABASE_URL
            fromDatabase:
                name: email-sorter-db
                property: connectionString
          - key: AUTH_SECRET
            generateValue: true
          - key: AUTH_URL
            sync: false
          - key: GOOGLE_CLIENT_ID
            sync: false
          - key: GOOGLE_CLIENT_SECRET
            sync: false
          - key: GEMINI_API_KEY
            sync: false
          - key: CRON_SECRET
            generateValue: true

databases:
    - name: email-sorter-db
      region: oregon
      plan: free
      ipAllowList: []
